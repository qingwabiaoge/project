<meta charset="utf-8"/>
<script src="https://cdn.bootcss.com/axios/0.18.0/axios.min.js"></script>

<script>

   const store={state:{token:{token:'this is token'}}}

   axios.defaults.baseURL ='http://localhost:3000'
  // axios.defaults.headers.common['Authorization'] ='AUTH_TOKEN';
   axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';

    // 添加请求拦截器,请求数据前做些什么
    axios.interceptors.request.use(
        config => {
            // 在发送请求之前1做些什么：每次发送请求之前检测都vuex存有token,那么都要放在请求头发送给服务器
            if (store.state.token.token) {
                config.headers.Authorization = `token ${store.state.token.token}`;
            }
            // loadinginstace = Loading.service({fullscreen: true}) // 请求打开loading
            return config;
        },
        err => {
            // 对请求错误做些什么
            return Promise.reject(err);
        }
    );
    //拦截并处理数据
    axios.interceptors.response.use(
        // status=2xx的 正确的的走这里
        res => {
            console.log('默认返回的报文res:',res)

            if (res.data.code === -1&&res.data.msg) {
                // alert(res.data.data.msg)
            } else {
                if (res.data.msg) {
                   alert(res.data.msg)
                }

                return res.data.data;

            }

        },
        //检测status默认除了2XX之外的都是错误的，就会走这里
        error => {
            if (error.response) {

                switch (error.response.status) {
                    case 401:
                        alert('登陆过期，请重新登陆' )
                        break
                    case 404:
                        alert('404错误，请检查网络' + error.response.statusText)
                        break

                    default:
                        alert('错误:' + error.response.statusText)


                }
            }
            return Promise.reject(error.response);
        }
    );



    axios.get('/request').then(_=>{console.log('这是过滤后的数据:',_)})


</script>