function getAjaxData(e){var s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){},o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"get",n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};layer.load(1,{shade:[.3,"#000"]});var t={url:e,type:o.toLocaleUpperCase(),success:function(e){layer.closeAll(),500===e.status?layer.msg(e.message,{icon:2,shade:[.001,"#000"]}):401===e.status?layer.confirm(e.message,{title:getSysValueByKey("sys_layer_confirm_title"),btn:getSysValueByKey("sys_layer_confirm_btn_yes"),yes:function(e){layer.close(e)}}):s&&s(e)},error:function(e){console.log("error:",e),layer.msg(e.message,{icon:2})}};"post"==o&&(t=Object.assign({},t,{contentType:"application/json; charset=utf-8",traditional:!0,data:JSON.stringify(n)})),$.ajax(t)}function getSysValueByKey(e){return $("#sysKeys").val()?JSON.parse($("#sysKeys").val())[e]:""}function loginOut(){layer.confirm(getSysValueByKey("sys_layer_confirm_logOut"),{title:getSysValueByKey("sys_layer_confirm_title"),btn:getSysValueByKey("sys_layer_confirm_btn_yes"),yes:function(e){layer.close(e),getAjaxData("/users/logOut",function(e){200==e.status&&layer.msg(e.message,{icon:1},function(){window.location="/"})})}})}function getScrollTop(){return document.documentElement.scrollTop||window.pageYOffset||document.body.scrollTop}function initCheckModal(e,s,o){$("#checkIfDo").on("show.bs.modal",function(e){$(this).find(".modal-msg").text(s)}).on("hide.bs.modal",function(e){}),$("#checkIfDo").modal("show"),e.confirmDo=function(){$("#checkIfDo").modal("hide"),o()}}$(function(){$("#userLoginOut").click(function(){loginOut()}),$("#gotop").click(function(){return $("body,html").animate({scrollTop:0},800),!1}),$(window).scroll(function(e){100<getScrollTop()?$("#gotop").css("opacity",1):$("#gotop").css("opacity",0)})}),layer.config({extend:"blue/layer.css",skin:"layui-layer-blue"}),avalon.filters.cutwords=function(e,s){return e?e.replace(/[\u0391-\uFFE5]/g,"aa").length>s?e.substring(0,s)+"...":e:""},avalon.filters.formatDateByType=function(e,s){var o="";return"mini"==s?o=e.substring(e.length-8,e.length-3):(s="date")&&(o=e.substring(0,9)),o};var searchVm=avalon.define({$id:"headerCtr",lsk:[],searchkey:"",message:"",activeSearch:!1,showErr:!1,postArticel:function(){"true"==$("#logined").val()?window.location.href="/users/userAddContent":window.location.href="/users/login"},searchMe:function(){searchVm.activeSearch=!searchVm.activeSearch},searchOpt:function(e){searchVm.searchkey&&13==e.keyCode&&(window.location.href="/search/"+searchVm.searchkey)}}),postArticelVm=avalon.define({$id:"documentInfo",message:"",showErr:!1}),adminLoginVm=avalon.define({$id:"adminUserlogin",password:"",userName:"",message:"",imageCode:"",showErr:!1,imgCodeUrl:"/api/getImgCode",reSetImgCode:function(){adminLoginVm.imgCodeUrl="/api/getImgCode?"+Math.random()},validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),adminLoginVm.showErr=!0,adminLoginVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/api/admin/doLogin",function(e){200==e.status?window.location.href="/manage":(adminLoginVm.showErr=!0,adminLoginVm.message=e.message,adminLoginVm.reSetImgCode())},"post",{userName:adminLoginVm.userName,password:CryptoJS.MD5("dora"+adminLoginVm.password).toString(),imageCode:adminLoginVm.imageCode}))}}}),confirmEmailVm=avalon.define({$id:"confirmEmail",email:"",message:"",showErr:!1,validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),confirmEmailVm.showErr=!0,confirmEmailVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/users/sentConfirmEmail",function(e){200==e.status?layer.msg(e.message,{icon:1,anim:1},function(){window.location.href="/"}):(confirmEmailVm.showErr=!0,confirmEmailVm.message=e.message)},"post",{email:confirmEmailVm.email}))}}}),loginVm=avalon.define({$id:"userlogin",password:"",email:"",message:"",showErr:!1,reset:function(){loginVm.email=" ",loginVm.password=" "},validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),loginVm.showErr=!0,loginVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/users/doLogin",function(e){200==e.status&&layer.msg(e.message,{icon:1},function(){window.location.href="/ "})},"post",{email:loginVm.email,password:loginVm.password}))}}});function getPostMessages(){getAjaxData("/api/message/getList?pageSize=100&contentId="+$("#contentId").val(),function(e){200==e.status&&(postMsgVm.messageList=e.data.docs)})}var postMsgVm=avalon.define({$id:"postMessage",content:"",logined:!1,message:"",showErr:!1,messageList:[],replyState:!1,relationMsgId:"",replyAuthor:"",adminReplyAuthor:"",getAuthor:function(e,s,o){var n=e[s];return n||(e[o]?e[o]:"")},reSetData:function(){postMsgVm.content="",postMsgVm.relationMsgId="",postMsgVm.replyAuthor="",postMsgVm.adminReplyAuthor="",postMsgVm.showErr=!1,postMsgVm.message=""},reply:function(e,s,o){postMsgVm.reSetData(),postMsgVm.replyState=!0,postMsgVm.relationMsgId=e,"0"==o?postMsgVm.replyAuthor=s._id:postMsgVm.adminReplyAuthor=s._id,$("#msgSendBox").appendTo($("#msglist_"+e))},cancelReply:function(){postMsgVm.reSetData(),postMsgVm.replyState=!1,$("#postMessage").prepend($("#msgSendBox"))},validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){if(e.length)postMsgVm.showErr=!0,postMsgVm.message=e[0].message;else if(console.log("全部通过"),"true"==$("#logined").val()){var s=postMsgVm.$model;s.contentId=$("#contentId").val(),delete s.messageList,getAjaxData("/users/message/post",function(e){200==e.status&&($("#postMessage").prepend($("#msgSendBox")),postMsgVm.reSetData(),getPostMessages())},"post",s)}else window.location.href="/users/login"}}});function getUserRelevantList(e,s,o){getAjaxData("/users/"+e+"?current="+o,function(e){200==e.status&&("myContents"==s?(myContentsVm.myContentList=e.data.docs,myContentsVm.contentTotalPage=e.data.pageInfo.totalPage):"myMessages"==s?(myContentsVm.myMessageList=e.data.docs,myContentsVm.messageTotalPage=e.data.pageInfo.totalPage):"myJoinTopics"==s&&(myContentsVm.myJoinTopicsList=e.data.docs,myContentsVm.joinTopicsTotalPage=e.data.pageInfo.totalPage))})}var myContentsVm=avalon.define({$id:"my-contents",myContentList:[],myMessageList:[],myJoinTopicsList:[],contentTotalPage:1,messageTotalPage:1,joinTopicsTotalPage:1,contentPageClick:function(e,s){getUserRelevantList("getUserContents","myContents",s)},messagePageClick:function(e,s){getUserRelevantList("getUserNotifys","myMessages",s)},joinTopicPageClick:function(e,s){getUserRelevantList("getUserReplies","myJoinTopics",s)},showMessageDetails:function(e,s){e.preventDefault();var o=e.target;$(o).toggleClass("fa-angle-down"),$(o).parent().next().toggleClass("show"),s.isRead||getAjaxData("/users/setNoticeRead?ids="+s.id,function(e){200==e.status&&getUserRelevantList("getUserNotifys","myMessages",1)})},deleteNotify:function(s){layer.confirm(getSysValueByKey("sys_layer_confirm_delete"),{title:getSysValueByKey("sys_layer_confirm_title"),btn:getSysValueByKey("sys_layer_confirm_btn_yes"),yes:function(e){layer.close(e),getAjaxData("/users/delUserNotify?ids="+s,function(e){200==e.status&&layer.msg(getSysValueByKey("sys_layer_option_success"),{icon:1},function(){getUserRelevantList("getUserNotifys","myMessages",1)})})}})}}),regVm=avalon.define({$id:"reglogin",userName:"",password:"",confirmPassword:"",email:"",message:"",showErr:!1,validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),regVm.showErr=!0,regVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/users/doReg",function(e){200==e.status&&layer.msg(e.message,{icon:1},function(){window.location.href="/"})},"post",{userName:regVm.userName,email:regVm.email,password:regVm.password,confirmPassword:regVm.confirmPassword}))}}}),reSetPsdVm=avalon.define({$id:"reSetPsd",password:"",confirmPassword:"",message:"",showErr:!1,validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),reSetPsdVm.showErr=!0,reSetPsdVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/users/updateNewPsd",function(e){200==e.status&&layer.msg(e.message,{icon:1},function(){window.location.href="/users/login"})},"post",{tokenId:$("#tokenId").val(),confirmPassword:reSetPsdVm.confirmPassword,password:reSetPsdVm.password}))}}}),sendEmailInfoVm=avalon.define({$id:"email-user-info",name:"",email:"",comments:"",phoneNum:"",message:"",showErr:!1,validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),sendEmailInfoVm.showErr=!0,sendEmailInfoVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/users/postEmailToAdminUser",function(e){200==e.status&&layer.msg(e.message,{icon:1},function(){window.location.href="/"})},"post",{email:sendEmailInfoVm.email,name:sendEmailInfoVm.name,phoneNum:sendEmailInfoVm.phoneNum,comments:sendEmailInfoVm.comments}))}}}),setPsdVm=avalon.define({$id:"setPsd",password:"",confirmPassword:"",message:"",showErr:!1,validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),setPsdVm.showErr=!0,setPsdVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/users/updateInfo",function(e){200==e.status&&layer.msg(e.message,{icon:1})},"post",{confirmPassword:setPsdVm.confirmPassword,password:setPsdVm.password}))}}}),userInfoVm=avalon.define({$id:"user-info",userName:"",name:"",email:"",comments:"",phoneNum:"",message:"",showErr:!1,validate:{onError:function(e){e.forEach(function(e){console.log(e.getMessage())})},onValidateAll:function(e){e.length?(console.log("有表单没有通过",e),userInfoVm.showErr=!0,userInfoVm.message=e[0].message):(console.log("全部通过"),getAjaxData("/users/updateInfo",function(e){200==e.status&&layer.msg(e.message,{icon:1})},"post",{userName:userInfoVm.userName,email:userInfoVm.email,name:userInfoVm.name,phoneNum:userInfoVm.phoneNum,comments:userInfoVm.comments}))}}}),userNavVm=avalon.define({$id:"user-nav",currentPath:window.location.pathname});