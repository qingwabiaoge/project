<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="https://cdn.bootcss.com/vue/2.5.17-beta.0/vue.js"></script>
    <script src="https://cdn.bootcss.com/vuex/3.0.1/vuex.js"></script>
    <script src="https://cdn.bootcss.com/element-ui/2.4.0/index.js"></script>
    <link href="https://cdn.bootcss.com/element-ui/2.4.0/theme-chalk/index.css" rel="stylesheet">

</head>
<body>

<div id="app">
    {{form}}
    <el-form ref="form" :model="form" :rules="rules">
        <el-form-item label="Upload" prop="file">
            <el-upload
                    action="http://localhost:3000/upfile/"
                    list-type="picture-card"
                    :on-preview="handlePictureCardPreview"
                    :on-remove="handleRemove"
                    :fileList='form.fileList'
                    :on-success="handleAvatarSuccess"
            >
                <i class="el-icon-plus"></i>
            </el-upload>
            <el-dialog :visible.sync="dialogVisible">
                <img width="100%" :src="dialogImageUrl" alt="">
            </el-dialog>
        </el-form-item>
        <el-form-item>
            <el-form-item>
                <el-button type="primary" @click="submitForm('form')">立即创建</el-button>
                <el-button @click="resetForm('form')">重置</el-button>
            </el-form-item>

        </el-form-item>

    </el-form>
</div>

<script>
    const vm = new Vue({
        el:'#app',
        data() {
            return {
                dialogImageUrl: '',
                dialogVisible: false,
                form: {
                    fileList: []
                },
                rules: {
                    file: [
                        {required: true, message: '请上传缩略图', trigger: 'change'}
                    ],
                }
            };
        },
        methods: {
            handleRemove(file, fileList) {
                console.log(file, fileList);
            },
            handlePictureCardPreview(file) {
                this.dialogImageUrl = file.url;
                this.dialogVisible = true;
            },
            //上传成功的回调
            handleAvatarSuccess(res, file) {
                this.rules.file[0].required = false
                this.dialogImageUrl = res;

            }, submitForm(formName) {
                this.$refs[formName].validate((valid) => {
                    if (valid) {
                        alert('submit!');
                    } else {
                        console.log('error submit!!');
                        return false;
                    }
                });
            },
            resetForm(formName) {
                this.$refs[formName].resetFields();
            }
        }
    })
</script>


</body>
</html>